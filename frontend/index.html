<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"> <!-- Corrected from UTF-TF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UHMWPE防弹材料数据库 - 主页</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* 自定义滚动条样式 */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .sidebar-link { @apply block w-full text-left px-4 py-2.5 text-sm text-gray-700 hover:bg-blue-500 hover:text-white rounded-md transition-colors duration-150 flex items-center; }
        .sidebar-link svg { @apply mr-3 flex-shrink-0 h-5 w-5; }
        .sidebar-link.active { @apply bg-blue-600 text-white; }
        .stat-card { @apply p-6 rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 ease-in-out; }
        .stat-card-title { @apply text-xl font-semibold mb-2 flex items-center; }
        .stat-card-description { @apply text-sm mb-3; }
        .stat-card-number { @apply text-3xl font-bold; }
        .data-table { @apply min-w-full whitespace-nowrap bg-white rounded-lg shadow; }
        .data-table thead { @apply bg-gray-200; }
        .data-table th { @apply px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider; }
        .data-table tbody { @apply bg-white divide-y divide-gray-200; }
        .data-table td { @apply px-6 py-4 whitespace-nowrap text-sm; }
        .data-table td.text-gray-900 { @apply text-gray-900; }
        .data-table td.text-gray-500 { @apply text-gray-500; }
        .data-table .action-link { @apply font-medium; }
        .data-table .action-link-view { @apply text-indigo-600 hover:text-indigo-900; }
        .data-table .action-link-edit { @apply text-green-600 hover:text-green-900 ml-2 md:ml-4; }
        .data-table .action-link-delete { @apply text-red-600 hover:text-red-900 ml-2 md:ml-4; }
        .tab-button { @apply px-4 py-2 font-medium text-sm rounded-md transition-colors duration-150; }
        .tab-button.active { @apply bg-blue-600 text-white shadow-md; }
        .tab-button:not(.active) { @apply text-gray-600 hover:bg-gray-200 hover:text-gray-800; }
        .tab-content { @apply hidden mt-6; }
        .tab-content.active { @apply block; }
        .action-button { @apply bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg shadow-sm flex items-center text-sm transition-colors duration-150; }
        .action-button svg { @apply h-4 w-4 mr-1.5; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 bg-white shadow-xl overflow-y-auto p-4 space-y-1">
            <div class="text-3xl font-extrabold text-blue-700 mb-8 text-center tracking-tight">
                材料数据库
            </div>
            <nav>
                <button class="sidebar-link active" data-module="home">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg>
                    首页
                </button>
                <button class="sidebar-link" data-module="resin_spinning">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01-.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>
                    前端树脂与纺丝工艺
                </button>
                <button class="sidebar-link" data-module="fiber_performance">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z" /><path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z" /></svg>
                    纤维性能
                </button>
                <button class="sidebar-link" data-module="microstructure">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                    微观结构特征
                </button>
                <button class="sidebar-link" data-module="resin_interface">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
                    树脂及界面性能
                </button>
                <button class="sidebar-link" data-module="composite_performance">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>
                    复合材料结构与性能
                </button>
                <button class="sidebar-link" data-module="ballistic_performance">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1.944A11.954 11.954 0 002.763 5.237L2 10c0 3.93 2.795 7.207 6.703 8.395A1.001 1.001 0 0010 19a1 1 0 001.297-.605C15.205 17.207 18 13.93 18 10l-.763-4.763A11.954 11.954 0 0010 1.944zm-1.06 11.083a1 1 0 001.414-1.414L11.414 10l-1.06-1.06a1 1 0 00-1.414 1.413L8.939 10l1.001 1.027zM10 12.5a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /><path d="M12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 11-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" /></svg>
                    终端产品防弹性能
                </button>
                <button class="sidebar-link" data-module="literature_standard">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v5a2 2 0 01-2 2H4a2 2 0 01-2-2v-5z" /></svg>
                    文献与标准
                </button>
                 <hr class="my-3 border-gray-200">
                <button class="sidebar-link" data-module="user_management">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" /></svg>
                    用户管理 (管理员)
                </button>
                <button class="sidebar-link" data-module="system_guide">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                    系统使用说明
                </button>
            </nav>
        </aside>

        <main class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white shadow-md p-4">
                <div class="flex justify-between items-center">
                    <div class="relative w-full max-w-xl">
                        <input type="search" id="mainSearch" placeholder="全局搜索：材料牌号、性能参数、文献标题、测试标准..." class="w-full pl-12 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4 ml-4">
                        <span class="text-gray-700">欢迎, <span id="username" class="font-semibold text-blue-600">管理员</span></span>
                        <button id="logoutButton" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-150 text-sm font-medium flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1.5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" /></svg>
                            退出
                        </button>
                    </div>
                </div>
            </header>

            <div id="contentArea" class="flex-1 p-6 lg:p-8 overflow-y-auto bg-gray-50">
                <!-- JS will populate this -->
            </div>
        </main>
    </div>

    <script>
        // All the JavaScript from the user-provided HTML (sidebar, module loading, homePageHTMLTemplate, etc.)
        // For brevity, I'm not pasting all of it again here, but the worker should use the full script block.
        // Key parts that are important for this step:
        const sidebarLinks = document.querySelectorAll('.sidebar-link');
        const contentArea = document.getElementById('contentArea');
        const mainSearchInput = document.getElementById('mainSearch');
        const logoutButton = document.getElementById('logoutButton');
        const usernameDisplay = document.getElementById('username'); // Ensure this ID is used for username display

        const homePageHTMLTemplate = `
            <div class="space-y-8" id="homeModuleContent">
                <div class="bg-white p-8 rounded-xl shadow-xl">
                    <h1 class="text-3xl lg:text-4xl font-extrabold text-gray-800 mb-3">欢迎使用 UHMWPE 防弹材料数据库</h1>
                    <p class="text-gray-600 text-lg mb-6 leading-relaxed">
                        本数据库系统整合了超高分子量聚乙烯 (UHMWPE) 从原材料到终端防弹产品的全链条数据，包括纤维性能、微观结构、树脂及界面特性、复合材料结构与性能以及关键的防弹试验数据。旨在为材料研发、性能优化、质量监控及新产品设计提供强有力的数据支持与决策依据。
                    </p>
                    <div class="flex space-x-4">
                        <button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors_duration-150 learn-more-btn">
                            了解更多
                        </button>
                        <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition-colors_duration-150 quick-start-btn">
                            快速开始
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <div class="stat-card bg-gradient-to-br from-blue-500 to-blue-700 text-white">
                        <h2 class="stat-card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" /></svg>
                            纤维性能数据
                        </h2>
                        <p class="stat-card-description opacity-90">UHMWPE纤维的物理、化学、力学及热性能数据。</p>
                        <p class="stat-card-number" id="fiberDataCount">0 条</p>
                    </div>
                    <div class="stat-card bg-gradient-to-br from-green-500 to-green-700 text-white">
                        <h2 class="stat-card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L9 9.61V16a1 1 0 001 1h2a1 1 0 001-1v-6.39l6.394-2.69a1 1 0 000-1.84l-7-3zM10 8.39L3.606 5.69 10 3.154 16.394 5.69 10 8.39z" /></svg>
                            复合材料性能
                        </h2>
                        <p class="stat-card-description opacity-90">静态、动态力学响应及仿真结果。</p>
                         <p class="stat-card-number" id="compositeDataCount">0 条</p>
                    </div>
                    <div class="stat-card bg-gradient-to-br from-purple-500 to-purple-700 text-white">
                        <h2 class="stat-card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
                            防弹性能试验
                        </h2>
                        <p class="stat-card-description opacity-90">详细的防弹试验条件、过程和结果数据。</p>
                        <p class="stat-card-number" id="ballisticDataCount">0 条</p>
                    </div>
                    <div class="stat-card bg-gradient-to-br from-yellow-500 to-yellow-700 text-white">
                        <h2 class="stat-card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 16c1.255 0 2.443-.29 3.5-.804V4.804zM14.5 4A7.969 7.969 0 0011 4.804v10A7.968 7.968 0 0114.5 16c1.255 0 2.443-.29 3.5-.804v-10A7.968 7.968 0 0014.5 4z" /></svg>
                            文献与标准
                        </h2>
                        <p class="stat-card-description opacity-90">相关的学术论文、行业标准和测试方法。</p>
                        <p class="stat-card-number" id="literatureDataCount">0 条</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-semibold text-gray-700 mb-4">最新动态与通知</h2>
                        <ul class="space-y-3">
                            <li class="border-b border-gray-200 pb-3">
                                <a href="#" class="text-blue-600 hover:text-blue-800 font-medium">新批次UHMWPE纤维性能数据已录入 (2024-03-15)</a>
                                <p class="text-sm text-gray-500 mt-1">详细信息请查看“纤维性能”模块。</p>
                            </li>
                            <li class="border-b border-gray-200 pb-3">
                                <a href="#" class="text-blue-600 hover:text-blue-800 font-medium">系统维护通知：下周三凌晨2:00-4:00</a>
                                <p class="text-sm text-gray-500 mt-1">届时系统将暂停服务，敬请谅解。</p>
                            </li>
                            <li>
                                <a href="#" class="text-blue-600 hover:text-blue-800 font-medium">《XXX防弹测试标准 GJB-XYZ-2023》已添加到文献库</a>
                                <p class="text-sm text-gray-500 mt-1">请相关人员查阅。</p>
                            </li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                         <h2 class="text-2xl font-semibold text-gray-700 mb-4">快速导航</h2>
                         <div class="space-y-2">
                            <a href="#" class="block bg-gray-100 hover:bg-gray-200 p-3 rounded-md text-gray-700 transition-colors quick-nav-link" data-target-module="fiber_performance">查看纤维数据</a>
                            <a href="#" class="block bg-gray-100 hover:bg-gray-200 p-3 rounded-md text-gray-700 transition-colors quick-nav-link" data-target-module="ballistic_performance">查询防弹试验</a>
                            <a href="#" class="block bg-gray-100 hover:bg-gray-200 p-3 rounded-md text-gray-700 transition-colors quick-nav-link" data-target-module="literature_standard">浏览文献标准</a>
                            <a href="#" class="block bg-gray-100 hover:bg-gray-200 p-3 rounded-md text-gray-700 transition-colors quick-nav-link" data-target-module="system_guide">阅读使用手册</a>
                         </div>
                    </div>
                </div>
            </div>
        `;

        function activateModule(moduleName) {
            // ... (rest of the activateModule function from user's HTML)
             sidebarLinks.forEach(l => {
                l.classList.remove('active');
                if (l.dataset.module === moduleName) {
                    l.classList.add('active');
                }
            });

            let moduleContentHTML = '';
            const moduleButton = document.querySelector(`.sidebar-link[data-module="${moduleName}"]`);
            const moduleTitle = moduleButton ? moduleButton.innerText.trim() : '未知模块';

            if (moduleName === 'home') {
                moduleContentHTML = homePageHTMLTemplate;
                contentArea.innerHTML = moduleContentHTML;
                loadDashboardStats(); 
                addQuickNavListeners(); 
                addLearnMoreListeners();
                return; 
            } else if (moduleName === 'resin_spinning') {
                moduleContentHTML = `
                    <div class="bg-white p-8 rounded-xl shadow-xl">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">${moduleTitle}</h1>
                        <p class="text-gray-600 mb-4">管理和查询前端树脂及纺丝工艺相关的参数，如树脂分子量、多分散系数、结晶度、熔点、原液浓度、纺丝温度等。</p>
                        <div class="mb-6 flex flex-wrap gap-3">
                            <button class="action-button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                                添加工艺参数
                            </button>
                            <button class="action-button bg-blue-500 hover:bg-blue-600">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                                批量导入参数
                            </button>
                             <button class="action-button bg-yellow-500 hover:bg-yellow-600">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293.707L3.293 7.293A1 1 0 013 6.586V4z" /></svg>
                                筛选工艺数据
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th><th>批号</th><th>树脂牌号</th><th>分子量 (g/mol)</th><th>PDI</th><th>熔点 (°C)</th><th>纺丝温度 (°C)</th><th>添加时间</th><th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-gray-900">RS-001</td><td class="text-gray-500">202401A-Resin</td><td class="text-gray-500">UHMWPE-R100</td><td class="text-gray-500">3.5x10⁶</td><td class="text-gray-500">2.8</td><td class="text-gray-500">145</td><td class="text-gray-500">170</td><td class="text-gray-500">2024-01-15 09:30</td>
                                        <td><a href="#" class="action-link action-link-view">查看</a><a href="#" class="action-link action-link-edit">编辑</a><a href="#" class="action-link action-link-delete">删除</a></td>
                                    </tr>
                                    <tr>
                                        <td class="text-gray-900">RS-002</td><td class="text-gray-500">202402B-Resin</td><td class="text-gray-500">UHMWPE-R200</td><td class="text-gray-500">4.2x10⁶</td><td class="text-gray-500">3.1</td><td class="text-gray-500">148</td><td class="text-gray-500">175</td><td class="text-gray-500">2024-02-20 14:00</td>
                                        <td><a href="#" class="action-link action-link-view">查看</a><a href="#" class="action-link action-link-edit">编辑</a><a href="#" class="action-link action-link-delete">删除</a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                         <p class="text-gray-500 text-sm italic mt-4">（完整数据表包含更多工艺参数，如结晶度、原液浓度、双螺杆速率、凝固浴温度、拉伸温度等。）</p>
                    </div>`;
            } else if (moduleName === 'fiber_performance') {
                moduleContentHTML = `
                    <div class="bg-white p-8 rounded-xl shadow-xl">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">${moduleTitle}</h1>
                        <p class="text-gray-600 mb-4">管理和查询UHMWPE纤维的样品基本信息、分子量、热性能（DSC, TGA, 热导率）以及力学性能（拉伸, 蠕变, 动态拉伸）。</p>
                        <div class="mb-6 border-b border-gray-200" id="fiberPerformanceNavContainer"><nav class="flex space-x-1 -mb-px" aria-label="Tabs"><button class="tab-button active" data-tab="fiber-basic-molecular">基本信息与分子量</button><button class="tab-button" data-tab="fiber-thermal">热性能</button><button class="tab-button" data-tab="fiber-mechanical">力学性能</button></nav></div>
                        <div id="fiberTabsContent">
                            <div class="tab-content active" id="fiber-basic-molecular">
                                <h2 class="text-2xl font-semibold text-gray-700 mb-4">纤维样品基本信息</h2>
                                <div class="mb-6 flex flex-wrap gap-3"><button class="action-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>添加基本信息</button></div>
                                <div class="overflow-x-auto mb-8"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>牌号</th><th>样品来源</th><th>生产日期</th><th>线密度(dtex)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">FB-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">Type-X1</td><td class="text-gray-500">供应商A</td><td class="text-gray-500">2023-01-10</td><td class="text-gray-500">1600</td><td><a href="#" class="action-link action-link-view">查看</a><a href="#" class="action-link action-link-edit">编辑</a><a href="#" class="action-link action-link-delete">删除</a></td></tr></tbody></table></div>
                                <h2 class="text-2xl font-semibold text-gray-700 mb-4">纤维分子量</h2>
                                 <div class="mb-6 flex flex-wrap gap-3"><button class="action-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>添加分子量数据</button></div>
                                <div class="overflow-x-auto"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>牌号</th><th>测试日期</th><th>粘均分子量(g/mol)</th><th>结果图</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">MW-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">Type-X1</td><td class="text-gray-500">2023-01-15</td><td class="text-gray-500">3.0x10⁶</td><td class="text-gray-500"><a href="#" class="action-link action-link-view">查看图谱</a></td><td><a href="#" class="action-link action-link-view">查看</a><a href="#" class="action-link action-link-edit">编辑</a><a href="#" class="action-link action-link-delete">删除</a></td></tr></tbody></table></div>
                            </div>
                            <div class="tab-content" id="fiber-thermal">
                                <h3 class="text-xl font-semibold text-gray-700 mb-3">差示扫描量热分析 (DSC)</h3><div class="overflow-x-auto mb-6"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>熔融温度(°C)</th><th>结晶度(%)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">DSC-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">145.5</td><td class="text-gray-500">82.3</td><td><a href="#" class="action-link action-link-view">查看</a></td></tr></tbody></table></div>
                                <h3 class="text-xl font-semibold text-gray-700 mb-3">热重分析 (TGA)</h3><div class="overflow-x-auto mb-6"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>5%失重温度(°C)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">TGA-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">350.1</td><td><a href="#" class="action-link action-link-view">查看</a></td></tr></tbody></table></div>
                                <h3 class="text-xl font-semibold text-gray-700 mb-3">热导率</h3><div class="overflow-x-auto"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>导热系数(W/mK)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">TC-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">0.045</td><td><a href="#" class="action-link action-link-view">查看</a></td></tr></tbody></table></div>
                                <div class="mt-6"><button class="action-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>添加热性能数据</button></div>
                            </div>
                            <div class="tab-content" id="fiber-mechanical">
                                <h3 class="text-xl font-semibold text-gray-700 mb-3">拉伸性能</h3><div class="overflow-x-auto mb-6"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>断裂强度(GPa)</th><th>初始模量(GPa)</th><th>断裂伸长率(%)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">FM-T-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">3.6</td><td class="text-gray-500">125</td><td class="text-gray-500">2.9</td><td><a href="#" class="action-link action-link-view">查看</a></td></tr></tbody></table></div>
                                <h3 class="text-xl font-semibold text-gray-700 mb-3">蠕变性能</h3><div class="overflow-x-auto mb-6"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>蠕变率(%/24h)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">FM-C-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">0.05</td><td><a href="#" class="action-link action-link-view">查看</a></td></tr></tbody></table></div>
                                <h3 class="text-xl font-semibold text-gray-700 mb-3">动态拉伸性能</h3><div class="overflow-x-auto"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>破坏应力(GPa)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">FM-D-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">3.2</td><td><a href="#" class="action-link action-link-view">查看</a></td></tr></tbody></table></div>
                                <div class="mt-6"><button class="action-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>添加力学性能数据</button></div>
                            </div>
                        </div>
                    </div>`;
                setTimeout(initializeFiberPerformanceTabs, 0);
            } else if (moduleName === 'microstructure') {
                 moduleContentHTML = `
                    <div class="bg-white p-8 rounded-xl shadow-xl">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">${moduleTitle}</h1>
                        <p class="text-gray-600 mb-4">管理和查询纤维的微观结构特征，包括相结构、取向与晶体结构、微观形貌及表面特性。</p>
                        <div class="mb-6 border-b border-gray-200" id="microstructureNavContainer"><nav class="flex space-x-1 -mb-px" aria-label="Tabs"><button class="tab-button active" data-tab="micro-phase">相结构 (NMR/Raman)</button><button class="tab-button" data-tab="micro-orientation">取向与晶体结构 (声速)</button><button class="tab-button" data-tab="micro-morphology">微观形貌 (SEM)</button><button class="tab-button" data-tab="micro-surface">表面特性 (XPS)</button></nav></div>
                        <div id="microstructureTabsContent">
                            <div class="tab-content active" id="micro-phase">
                                <h2 class="text-2xl font-semibold text-gray-700 mb-4">纤维相结构 (固态1H NMR)</h2><div class="mb-6 flex flex-wrap gap-3"><button class="action-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>添加NMR数据</button></div>
                                <div class="overflow-x-auto"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>牌号</th><th>无定形区占比(%)</th><th>中间相占比(%)</th><th>晶相占比(%)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">NMR-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">Type-X1</td><td class="text-gray-500">10.2</td><td class="text-gray-500">5.1</td><td class="text-gray-500">84.7</td><td><a href="#" class="action-link action-link-view">查看</a><a href="#" class="action-link action-link-edit">编辑</a><a href="#" class="action-link action-link-delete">删除</a></td></tr></tbody></table><p class="text-gray-500 text-xs italic mt-2">注：还可包含拉曼光谱数据，如结晶度等。</p></div>
                            </div>
                            <div class="tab-content" id="micro-orientation">
                                <h2 class="text-2xl font-semibold text-gray-700 mb-4">纤维取向及晶体结构 (声速模量)</h2><div class="mb-6 flex flex-wrap gap-3"><button class="action-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>添加声速模量数据</button></div>
                                <div class="overflow-x-auto"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>牌号</th><th>声速(m/s)</th><th>取向因子</th><th>模量(GPa)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">SM-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">Type-X1</td><td class="text-gray-500">10500</td><td class="text-gray-500">0.95</td><td class="text-gray-500">118</td><td><a href="#" class="action-link action-link-view">查看</a><a href="#" class="action-link action-link-edit">编辑</a><a href="#" class="action-link action-link-delete">删除</a></td></tr></tbody></table></div>
                            </div>
                            <div class="tab-content" id="micro-morphology">
                                <h2 class="text-2xl font-semibold text-gray-700 mb-4">微观形貌 (SEM)</h2><div class="mb-6 flex flex-wrap gap-3"><button class="action-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>添加SEM数据</button></div>
                                <div class="overflow-x-auto"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>牌号</th><th>放大倍数</th><th>特殊形貌特征描述</th><th>结果图</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">SEM-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">Type-X1</td><td class="text-gray-500">5000x</td><td class="text-gray-500">表面光滑，少量原纤</td><td class="text-gray-500"><a href="#" class="action-link action-link-view">查看图片</a></td><td><a href="#" class="action-link action-link-view">查看</a><a href="#" class="action-link action-link-edit">编辑</a><a href="#" class="action-link action-link-delete">删除</a></td></tr></tbody></table></div>
                            </div>
                            <div class="tab-content" id="micro-surface">
                                <h2 class="text-2xl font-semibold text-gray-700 mb-4">纤维表面特性 (XPS)</h2><div class="mb-6 flex flex-wrap gap-3"><button class="action-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>添加XPS数据</button></div>
                                <div class="overflow-x-auto"><table class="data-table"><thead><tr><th>ID</th><th>批号</th><th>牌号</th><th>C含量(at%)</th><th>O含量(at%)</th><th>N含量(at%)</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">XPS-001</td><td class="text-gray-500">2023A-FIB</td><td class="text-gray-500">Type-X1</td><td class="text-gray-500">98.5</td><td class="text-gray-500">1.2</td><td class="text-gray-500">0.3</td><td><a href="#" class="action-link action-link-view">查看</a><a href="#" class="action-link action-link-edit">编辑</a><a href="#" class="action-link action-link-delete">删除</a></td></tr></tbody></table></div>
                            </div>
                        </div>
                    </div>`;
                setTimeout(initializeMicrostructureTabs, 0);
            } else {
                moduleContentHTML = `
                    <div class="bg-white p-8 rounded-xl shadow-xl">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">${moduleTitle}</h1>
                        <p class="text-gray-600 mb-4">这里将显示与“${moduleTitle}”模块相关的数据列表、筛选条件和操作按钮。</p>
                        <p class="text-gray-500 text-sm italic">（此为演示界面，表格和具体数据交互功能需后端API支持和进一步的前端开发。）</p>
                        <div class="mb-6 flex flex-wrap gap-3"><button class="action-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>添加新数据</button></div>
                        <div class="overflow-x-auto"><table class="data-table"><thead><tr><th>ID</th><th>关键参数1</th><th>操作</th></tr></thead><tbody><tr><td class="text-gray-900">DUMMY-001</td><td class="text-gray-500">占位数据</td><td><a href="#" class="action-link action-link-view">查看</a></td></tr></tbody></table></div>
                    </div>`;
            }
            contentArea.innerHTML = moduleContentHTML;
        }

        function initializeFiberPerformanceTabs() { /* ... same as provided ... */ 
            const navContainer = contentArea.querySelector('#fiberPerformanceNavContainer nav');
            if (!navContainer) return; 
            const tabButtons = navContainer.querySelectorAll('.tab-button');
            const tabContentsContainer = contentArea.querySelector('#fiberTabsContent');
            if (!tabContentsContainer) return;
            const tabContents = tabContentsContainer.querySelectorAll('.tab-content');
            if (tabButtons.length === 0 || tabContents.length === 0) return;
            let isActiveSet = Array.from(tabButtons).some(button => button.classList.contains('active'));
            if (!isActiveSet && tabButtons.length > 0) {
                tabButtons[0].classList.add('active');
                const firstTabId = tabButtons[0].dataset.tab;
                const firstTabContent = tabContentsContainer.querySelector(`#${firstTabId}`);
                if (firstTabContent) firstTabContent.classList.add('active');
            }
            tabButtons.forEach(button => {
                button.removeEventListener('click', handleTabButtonClick); 
                button.addEventListener('click', handleTabButtonClick);
            });
        }

        // --- START: Resin Spinning Module JS ---
        function initializeResinSpinningModule() {
            console.log('前端树脂与纺丝工艺参数模块已初始化。');
            loadResinSpinningData(); 

            const addBtn = document.getElementById('addResinSpinningBtn');
            if(addBtn) addBtn.addEventListener('click', () => openResinSpinningModal());
            
            const refreshBtn = document.getElementById('refreshResinSpinningBtn');
            if(refreshBtn) refreshBtn.addEventListener('click', () => loadResinSpinningData(
                parseInt(document.querySelector('#resinSpinningPagination .current-page-display')?.dataset.currentPage || '1'),
                10, 
                { 
                    batch_number: document.getElementById('searchBatchNumber')?.value,
                    material_grade: document.getElementById('searchMaterialGrade')?.value
                }
            ));

            const searchBtn = document.getElementById('searchResinSpinningBtn');
            if(searchBtn) searchBtn.addEventListener('click', () => {
                const filters = {
                    batch_number: document.getElementById('searchBatchNumber').value,
                    material_grade: document.getElementById('searchMaterialGrade').value
                };
                loadResinSpinningData(1, 10, filters);
            });

            const clearSearchBtn = document.getElementById('clearSearchResinSpinningBtn');
            if(clearSearchBtn) clearSearchBtn.addEventListener('click', () => {
                const batchNumInput = document.getElementById('searchBatchNumber');
                const materialGradeInput = document.getElementById('searchMaterialGrade');
                if(batchNumInput) batchNumInput.value = '';
                if(materialGradeInput) materialGradeInput.value = '';
                loadResinSpinningData();
            });
            
            const form = document.getElementById('resinSpinningForm');
            if(form) form.addEventListener('submit', handleSaveResinSpinning);
            
            const closeModalBtn = document.getElementById('closeResinSpinningModalBtn');
            if(closeModalBtn) closeModalBtn.addEventListener('click', () => closeResinSpinningModal());
            
            const cancelModalBtn = document.getElementById('cancelResinSpinningModalBtn');
            if(cancelModalBtn) cancelModalBtn.addEventListener('click', () => closeResinSpinningModal());
            
            const tableBody = document.getElementById('resinSpinningTableBody');
            if(tableBody) {
                tableBody.addEventListener('click', function(event) {
                    const target = event.target;
                    const editButton = target.closest('.edit-rs-btn');
                    const deleteButton = target.closest('.delete-rs-btn');

                    if (editButton) {
                        const recordId = editButton.dataset.id;
                        openResinSpinningModal(recordId);
                    } else if (deleteButton) {
                        const recordId = deleteButton.dataset.id;
                        if (confirm(`您确定要删除记录 ID ${recordId} 吗？此操作无法撤销。`)) {
                            deleteResinSpinningRecord(recordId);
                        }
                    }
                });
            }
        }

        async function loadResinSpinningData(page = 1, perPage = 10, filters = {}) {
            if(typeof showLoading === 'function') showLoading(true, '加载树脂纺丝数据...');
            
            const tableBody = document.getElementById('resinSpinningTableBody');
            const paginationControls = document.getElementById('resinSpinningPagination');
            
            if (!tableBody || !paginationControls) {
                console.error('树脂纺丝模块的表格或分页元素未找到。');
                if(typeof showLoading === 'function') showLoading(false);
                return;
            }

            let queryParams = `?page=${page}&per_page=${perPage}`;
            for (const key in filters) {
                if (filters[key] && String(filters[key]).trim() !== '') {
                    queryParams += `&${encodeURIComponent(key)}=${encodeURIComponent(String(filters[key]).trim())}`;
                }
            }

            try {
                const response = await fetch(`/api/resin-spinning${queryParams}`);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: `HTTP 错误 ${response.status}` }));
                    throw new Error(errorData.message || `加载数据失败 (状态码: ${response.status})`);
                }
                const data = await response.json();

                if (data.success && data.records) {
                    tableBody.innerHTML = ''; 
                    if (data.records.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500 py-10">未找到符合条件的记录。</td></tr>';
                    } else {
                        data.records.forEach(record => {
                            const row = tableBody.insertRow();
                            row.className = 'hover:bg-gray-50 transition-colors duration-150';
                            row.innerHTML = `
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${record.record_id}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${record.batch_number || 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${record.material_grade || 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.resin_molecular_weight_g_mol || 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.spinning_temperature_c || 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(record.created_at).toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="text-indigo-600 hover:text-indigo-800 transition-colors duration-150 edit-rs-btn" data-id="${record.record_id}">编辑</button>
                                    <button class="text-red-600 hover:text-red-800 transition-colors duration-150 delete-rs-btn" data-id="${record.record_id}">删除</button>
                                </td>
                            `;
                        });
                    }
                    renderResinSpinningPagination(data, filters);
                } else {
                    tableBody.innerHTML = `<tr><td colspan="7" class="text-center text-red-500 py-10">加载数据失败: ${data.message || '未知错误'}</td></tr>`;
                }
            } catch (error) {
                console.error('加载树脂纺丝数据时出错:', error);
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center text-red-500 py-10">加载数据出错: ${error.message}</td></tr>`;
                if(typeof showToast === 'function') showToast(`加载数据出错: ${error.message}`, 'error');
            } finally {
                if(typeof showLoading === 'function') showLoading(false);
            }
        }

        function renderResinSpinningPagination(data, filters) {
            const paginationControls = document.getElementById('resinSpinningPagination');
            if (!paginationControls) return;

            paginationControls.innerHTML = `
                <span class="text-sm text-gray-700 current-page-display" data-current-page="${data.current_page}">
                    第 ${data.current_page} 页 / 共 ${data.pages || 1} 页 (总计 ${data.total || 0} 条记录)
                </span>
                <div class="inline-flex mt-2 xs:mt-0">
                    <button data-page="${data.current_page - 1}" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-l hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed prev-rs-page-btn" ${!data.has_prev ? 'disabled' : ''}>
                        上一页
                    </button>
                    <button data-page="${data.current_page + 1}" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-r border-0 border-l border-blue-700 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed next-rs-page-btn" ${!data.has_next ? 'disabled' : ''}>
                        下一页
                    </button>
                </div>
            `;
            paginationControls.querySelectorAll('.prev-rs-page-btn, .next-rs-page-btn').forEach(button => {
                button.addEventListener('click', function() {
                    if (!this.disabled) {
                        loadResinSpinningData(parseInt(this.dataset.page), 10, filters);
                    }
                });
            });
        }

        async function openResinSpinningModal(recordId = null) {
            const modal = document.getElementById('resinSpinningModal');
            const modalTitle = document.getElementById('resinSpinningModalTitle');
            const form = document.getElementById('resinSpinningForm');
            if (!form || !modal || !modalTitle) {
                console.error("Modal elements not found!");
                return;
            }
            form.reset();
            const recordIdField = form.elements['rs_record_id'] || form.elements['record_id'];
            if(recordIdField) recordIdField.value = '';


            if (recordId) {
                modalTitle.textContent = '编辑前端树脂与纺丝工艺参数';
                if(typeof showLoading === 'function') showLoading(true, '加载记录详情...');
                try {
                    const response = await fetch(`/api/resin-spinning/${recordId}`);
                    if (!response.ok) {
                         const errorData = await response.json().catch(() => ({ message: `HTTP错误 ${response.status}` }));
                         throw new Error(errorData.message || '无法加载记录。');
                    }
                    const data = await response.json();
                    if (data.success && data.record) {
                        const record = data.record;
                        for (const key in record) {
                            const formField = form.elements[`rs_${key}`] || form.elements[key];
                            if (formField) {
                                formField.value = record[key] !== null ? record[key] : '';
                            }
                        }
                         if(recordIdField) recordIdField.value = record.record_id;
                    } else {
                        throw new Error(data.message || '未找到记录数据。');
                    }
                } catch (error) {
                    if(typeof showToast === 'function') showToast(`加载编辑数据失败: ${error.message}`, 'error');
                    if(typeof showLoading === 'function') showLoading(false);
                    return; 
                } finally {
                    if(typeof showLoading === 'function') showLoading(false);
                }
            } else {
                modalTitle.textContent = '添加新的前端树脂与纺丝工艺参数';
            }
            modal.classList.remove('hidden');
            let tempStyle = document.getElementById('temp-modal-styles');
            if (!tempStyle) {
                tempStyle = document.createElement('style');
                tempStyle.id = 'temp-modal-styles';
                // Ensure input-field class is defined or used by your modal's inputs
                tempStyle.textContent = '.input-field { padding: 0.5rem 0.75rem; border: 1px solid #D1D5DB; border-radius: 0.375rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); outline: none;} .input-field:focus { ring-width: 2px; ring-color: #2563EB; border-color: #2563EB; }'; 
                document.head.appendChild(tempStyle);
            }
        }

        function closeResinSpinningModal() {
            const modal = document.getElementById('resinSpinningModal');
            if(modal) modal.classList.add('hidden');
        }

        async function handleSaveResinSpinning(event) {
            event.preventDefault();
            if(typeof showLoading === 'function') showLoading(true, '正在保存数据...');
            const form = event.target;
            const recordIdField = form.elements['rs_record_id'] || form.elements['record_id'];
            const recordId = recordIdField ? recordIdField.value : null;
            
            const formData = new FormData(form);
            const dataToSubmit = {};
            
            const allFields = ['batch_number', 'material_grade', 'supplier', 'resin_type', 
                'resin_molecular_weight_g_mol', 'polydispersity_index_pdi', 'intrinsic_viscosity_dl_g', 
                'melting_point_c', 'crystallinity_percent', 'spinning_method', 'solvent_system', 
                'solution_concentration_percent', 'spinning_temperature_c', 'spinneret_specifications', 
                'coagulation_bath_composition', 'coagulation_bath_temperature_c', 'draw_ratio', 
                'heat_treatment_temperature_c', 'remarks'];

            allFields.forEach(fieldKey => {
                const formKey = `rs_${fieldKey}`;
                const value = formData.get(formKey);
                const inputElement = form.elements[formKey];
                const inputType = inputElement ? inputElement.type : 'text';

                if (value === null || (typeof value === 'string' && value.trim() === '')) {
                     if (inputElement && inputType === 'number') {
                        dataToSubmit[fieldKey] = null;
                     } else if (!inputElement || !inputElement.required) { 
                        dataToSubmit[fieldKey] = null; 
                     } else {
                        dataToSubmit[fieldKey] = value; 
                     }
                } else {
                    dataToSubmit[fieldKey] = value;
                }
            });

            const url = recordId ? `/api/resin-spinning/${recordId}` : '/api/resin-spinning';
            const method = recordId ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSubmit)
                });
                const result = await response.json();
                if (!response.ok || !result.success) {
                    throw new Error(result.message || `保存失败 (状态码: ${response.status})`);
                }
                if(typeof showToast === 'function') showToast(result.message || '操作成功!', 'success');
                closeResinSpinningModal();
                loadResinSpinningData(); 
            } catch (error) {
                console.error('保存树脂纺丝数据失败:', error);
                if(typeof showToast === 'function') showToast(`保存失败: ${error.message}`, 'error');
            } finally {
                if(typeof showLoading === 'function') showLoading(false);
            }
        }

        async function deleteResinSpinningRecord(recordId) {
            if(typeof showLoading === 'function') showLoading(true, '正在删除记录...');
            try {
                const response = await fetch(`/api/resin-spinning/${recordId}`, { method: 'DELETE' });
                const result = await response.json();
                if (!response.ok || !result.success) {
                     throw new Error(result.message || `删除失败 (状态码: ${response.status})`);
                }
                if(typeof showToast === 'function') showToast(result.message || '记录已成功删除!', 'success');
                loadResinSpinningData(); 
            } catch (error) {
                console.error('删除树脂纺丝记录失败:', error);
                if(typeof showToast === 'function') showToast(`删除失败: ${error.message}`, 'error');
            } finally {
                if(typeof showLoading === 'function') showLoading(false);
            }
        }
        // --- END: Resin Spinning Module JS ---

        function initializeMicrostructureTabs() { /* ... same as provided ... */ 
            const navContainer = contentArea.querySelector('#microstructureNavContainer nav');
            if (!navContainer) return;
            const tabButtons = navContainer.querySelectorAll('.tab-button');
            const tabContentsContainer = contentArea.querySelector('#microstructureTabsContent');
            if(!tabContentsContainer) return;
            const tabContents = tabContentsContainer.querySelectorAll('.tab-content');
            if (tabButtons.length === 0 || tabContents.length === 0) return;
            let isActiveSet = Array.from(tabButtons).some(button => button.classList.contains('active'));
            if(!isActiveSet && tabButtons.length > 0) {
                tabButtons[0].classList.add('active');
                const firstTabId = tabButtons[0].dataset.tab;
                const firstTabContent = tabContentsContainer.querySelector(`#${firstTabId}`);
                if (firstTabContent) firstTabContent.classList.add('active');
            }
            tabButtons.forEach(button => {
                button.removeEventListener('click', handleTabButtonClick); 
                button.addEventListener('click', handleTabButtonClick);
            });
        }

        // --- START: Resin Spinning Module JS ---
        function initializeResinSpinningModule() {
            console.log('前端树脂与纺丝工艺参数模块已初始化。');
            loadResinSpinningData(); 

            const addBtn = document.getElementById('addResinSpinningBtn');
            if(addBtn) addBtn.addEventListener('click', () => openResinSpinningModal());
            
            const refreshBtn = document.getElementById('refreshResinSpinningBtn');
            if(refreshBtn) refreshBtn.addEventListener('click', () => loadResinSpinningData(
                parseInt(document.querySelector('#resinSpinningPagination .current-page-display')?.dataset.currentPage || '1'),
                10, 
                { 
                    batch_number: document.getElementById('searchBatchNumber')?.value,
                    material_grade: document.getElementById('searchMaterialGrade')?.value
                }
            ));

            const searchBtn = document.getElementById('searchResinSpinningBtn');
            if(searchBtn) searchBtn.addEventListener('click', () => {
                const filters = {
                    batch_number: document.getElementById('searchBatchNumber').value,
                    material_grade: document.getElementById('searchMaterialGrade').value
                };
                loadResinSpinningData(1, 10, filters);
            });

            const clearSearchBtn = document.getElementById('clearSearchResinSpinningBtn');
            if(clearSearchBtn) clearSearchBtn.addEventListener('click', () => {
                const batchNumInput = document.getElementById('searchBatchNumber');
                const materialGradeInput = document.getElementById('searchMaterialGrade');
                if(batchNumInput) batchNumInput.value = '';
                if(materialGradeInput) materialGradeInput.value = '';
                loadResinSpinningData();
            });
            
            const form = document.getElementById('resinSpinningForm');
            if(form) form.addEventListener('submit', handleSaveResinSpinning);
            
            const closeModalBtn = document.getElementById('closeResinSpinningModalBtn');
            if(closeModalBtn) closeModalBtn.addEventListener('click', () => closeResinSpinningModal());
            
            const cancelModalBtn = document.getElementById('cancelResinSpinningModalBtn');
            if(cancelModalBtn) cancelModalBtn.addEventListener('click', () => closeResinSpinningModal());
            
            const tableBody = document.getElementById('resinSpinningTableBody');
            if(tableBody) {
                tableBody.addEventListener('click', function(event) {
                    const target = event.target;
                    const editButton = target.closest('.edit-rs-btn');
                    const deleteButton = target.closest('.delete-rs-btn');

                    if (editButton) {
                        const recordId = editButton.dataset.id;
                        openResinSpinningModal(recordId);
                    } else if (deleteButton) {
                        const recordId = deleteButton.dataset.id;
                        if (confirm(`您确定要删除记录 ID ${recordId} 吗？此操作无法撤销。`)) {
                            deleteResinSpinningRecord(recordId);
                        }
                    }
                });
            }
        }

        async function loadResinSpinningData(page = 1, perPage = 10, filters = {}) {
            if(typeof showLoading === 'function') showLoading(true, '加载树脂纺丝数据...');
            
            const tableBody = document.getElementById('resinSpinningTableBody');
            const paginationControls = document.getElementById('resinSpinningPagination');
            
            if (!tableBody || !paginationControls) {
                console.error('树脂纺丝模块的表格或分页元素未找到。');
                if(typeof showLoading === 'function') showLoading(false);
                return;
            }

            let queryParams = `?page=${page}&per_page=${perPage}`;
            for (const key in filters) {
                if (filters[key] && String(filters[key]).trim() !== '') {
                    queryParams += `&${encodeURIComponent(key)}=${encodeURIComponent(String(filters[key]).trim())}`;
                }
            }

            try {
                const response = await fetch(`/api/resin-spinning${queryParams}`);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: `HTTP 错误 ${response.status}` }));
                    throw new Error(errorData.message || `加载数据失败 (状态码: ${response.status})`);
                }
                const data = await response.json();

                if (data.success && data.records) {
                    tableBody.innerHTML = ''; 
                    if (data.records.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500 py-10">未找到符合条件的记录。</td></tr>';
                    } else {
                        data.records.forEach(record => {
                            const row = tableBody.insertRow();
                            row.className = 'hover:bg-gray-50 transition-colors duration-150';
                            row.innerHTML = `
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${record.record_id}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${record.batch_number || 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${record.material_grade || 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.resin_molecular_weight_g_mol || 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.spinning_temperature_c || 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(record.created_at).toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button class="text-indigo-600 hover:text-indigo-800 transition-colors duration-150 edit-rs-btn" data-id="${record.record_id}">编辑</button>
                                    <button class="text-red-600 hover:text-red-800 transition-colors duration-150 delete-rs-btn" data-id="${record.record_id}">删除</button>
                                </td>
                            `;
                        });
                    }
                    renderResinSpinningPagination(data, filters);
                } else {
                    tableBody.innerHTML = `<tr><td colspan="7" class="text-center text-red-500 py-10">加载数据失败: ${data.message || '未知错误'}</td></tr>`;
                }
            } catch (error) {
                console.error('加载树脂纺丝数据时出错:', error);
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center text-red-500 py-10">加载数据出错: ${error.message}</td></tr>`;
                if(typeof showToast === 'function') showToast(`加载数据出错: ${error.message}`, 'error');
            } finally {
                if(typeof showLoading === 'function') showLoading(false);
            }
        }

        function renderResinSpinningPagination(data, filters) {
            const paginationControls = document.getElementById('resinSpinningPagination');
            if (!paginationControls) return;

            paginationControls.innerHTML = `
                <span class="text-sm text-gray-700 current-page-display" data-current-page="${data.current_page}">
                    第 ${data.current_page} 页 / 共 ${data.pages || 1} 页 (总计 ${data.total || 0} 条记录)
                </span>
                <div class="inline-flex mt-2 xs:mt-0">
                    <button data-page="${data.current_page - 1}" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-l hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed prev-rs-page-btn" ${!data.has_prev ? 'disabled' : ''}>
                        上一页
                    </button>
                    <button data-page="${data.current_page + 1}" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-r border-0 border-l border-blue-700 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed next-rs-page-btn" ${!data.has_next ? 'disabled' : ''}>
                        下一页
                    </button>
                </div>
            `;
            paginationControls.querySelectorAll('.prev-rs-page-btn, .next-rs-page-btn').forEach(button => {
                button.addEventListener('click', function() {
                    if (!this.disabled) {
                        loadResinSpinningData(parseInt(this.dataset.page), 10, filters);
                    }
                });
            });
        }

        async function openResinSpinningModal(recordId = null) {
            const modal = document.getElementById('resinSpinningModal');
            const modalTitle = document.getElementById('resinSpinningModalTitle');
            const form = document.getElementById('resinSpinningForm');
            if (!form || !modal || !modalTitle) {
                console.error("Modal elements not found!");
                return;
            }
            form.reset();
            const recordIdField = form.elements['rs_record_id'] || form.elements['record_id'];
            if(recordIdField) recordIdField.value = '';


            if (recordId) {
                modalTitle.textContent = '编辑前端树脂与纺丝工艺参数';
                if(typeof showLoading === 'function') showLoading(true, '加载记录详情...');
                try {
                    const response = await fetch(`/api/resin-spinning/${recordId}`);
                    if (!response.ok) {
                         const errorData = await response.json().catch(() => ({ message: `HTTP错误 ${response.status}` }));
                         throw new Error(errorData.message || '无法加载记录。');
                    }
                    const data = await response.json();
                    if (data.success && data.record) {
                        const record = data.record;
                        for (const key in record) {
                            const formField = form.elements[`rs_${key}`] || form.elements[key];
                            if (formField) {
                                formField.value = record[key] !== null ? record[key] : '';
                            }
                        }
                         if(recordIdField) recordIdField.value = record.record_id;
                    } else {
                        throw new Error(data.message || '未找到记录数据。');
                    }
                } catch (error) {
                    if(typeof showToast === 'function') showToast(`加载编辑数据失败: ${error.message}`, 'error');
                    if(typeof showLoading === 'function') showLoading(false);
                    return; 
                } finally {
                    if(typeof showLoading === 'function') showLoading(false);
                }
            } else {
                modalTitle.textContent = '添加新的前端树脂与纺丝工艺参数';
            }
            modal.classList.remove('hidden');
            let tempStyle = document.getElementById('temp-modal-styles');
            if (!tempStyle) {
                tempStyle = document.createElement('style');
                tempStyle.id = 'temp-modal-styles';
                // Ensure input-field class is defined or used by your modal's inputs
                tempStyle.textContent = '.input-field { padding: 0.5rem 0.75rem; border: 1px solid #D1D5DB; border-radius: 0.375rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); outline: none;} .input-field:focus { ring-width: 2px; ring-color: #2563EB; border-color: #2563EB; }'; 
                document.head.appendChild(tempStyle);
            }
        }

        function closeResinSpinningModal() {
            const modal = document.getElementById('resinSpinningModal');
            if(modal) modal.classList.add('hidden');
        }

        async function handleSaveResinSpinning(event) {
            event.preventDefault();
            if(typeof showLoading === 'function') showLoading(true, '正在保存数据...');
            const form = event.target;
            const recordIdField = form.elements['rs_record_id'] || form.elements['record_id'];
            const recordId = recordIdField ? recordIdField.value : null;
            
            const formData = new FormData(form);
            const dataToSubmit = {};
            
            const allFields = ['batch_number', 'material_grade', 'supplier', 'resin_type', 
                'resin_molecular_weight_g_mol', 'polydispersity_index_pdi', 'intrinsic_viscosity_dl_g', 
                'melting_point_c', 'crystallinity_percent', 'spinning_method', 'solvent_system', 
                'solution_concentration_percent', 'spinning_temperature_c', 'spinneret_specifications', 
                'coagulation_bath_composition', 'coagulation_bath_temperature_c', 'draw_ratio', 
                'heat_treatment_temperature_c', 'remarks'];

            allFields.forEach(fieldKey => {
                const formKey = `rs_${fieldKey}`;
                const value = formData.get(formKey);
                const inputElement = form.elements[formKey];
                const inputType = inputElement ? inputElement.type : 'text';

                if (value === null || (typeof value === 'string' && value.trim() === '')) {
                     // For numeric fields specifically, ensure null is passed if empty, not an empty string
                     if (inputElement && inputType === 'number') {
                        dataToSubmit[fieldKey] = null;
                     } else if (!inputElement || !inputElement.required) { // For non-required text fields, empty string is fine or null
                        dataToSubmit[fieldKey] = null; // Or "" if your backend prefers empty strings for optional text
                     } else {
                        dataToSubmit[fieldKey] = value; // Let backend handle validation for required empty strings
                     }
                } else {
                    dataToSubmit[fieldKey] = value;
                }
            });
            // record_id is already part of dataToSubmit if it was in the form (hidden field)
            // No need to add it separately if formKey was rs_record_id and fieldKey became record_id

            const url = recordId ? `/api/resin-spinning/${recordId}` : '/api/resin-spinning';
            const method = recordId ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSubmit)
                });
                const result = await response.json();
                if (!response.ok || !result.success) {
                    throw new Error(result.message || `保存失败 (状态码: ${response.status})`);
                }
                if(typeof showToast === 'function') showToast(result.message || '操作成功!', 'success');
                closeResinSpinningModal();
                loadResinSpinningData(); 
            } catch (error) {
                console.error('保存树脂纺丝数据失败:', error);
                if(typeof showToast === 'function') showToast(`保存失败: ${error.message}`, 'error');
            } finally {
                if(typeof showLoading === 'function') showLoading(false);
            }
        }

        async function deleteResinSpinningRecord(recordId) {
            if(typeof showLoading === 'function') showLoading(true, '正在删除记录...');
            try {
                const response = await fetch(`/api/resin-spinning/${recordId}`, { method: 'DELETE' });
                const result = await response.json();
                if (!response.ok || !result.success) {
                     throw new Error(result.message || `删除失败 (状态码: ${response.status})`);
                }
                if(typeof showToast === 'function') showToast(result.message || '记录已成功删除!', 'success');
                loadResinSpinningData(); 
            } catch (error) {
                console.error('删除树脂纺丝记录失败:', error);
                if(typeof showToast === 'function') showToast(`删除失败: ${error.message}`, 'error');
            } finally {
                if(typeof showLoading === 'function') showLoading(false);
            }
        }
        // --- END: Resin Spinning Module JS ---

        function handleTabButtonClick(event) { /* ... same as provided ... */
            const clickedButton = event.currentTarget;
            const navContainer = clickedButton.closest('nav'); 
            if (!navContainer) return;
            const tabButtons = navContainer.querySelectorAll('.tab-button');
            const tabNavContainer = navContainer.parentElement; 
            if (!tabNavContainer || !tabNavContainer.nextElementSibling) return;
            const tabContentsContainer = tabNavContainer.nextElementSibling; 
            if (!tabContentsContainer) return;
            const tabContents = tabContentsContainer.querySelectorAll('.tab-content');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            clickedButton.classList.add('active');
            const targetTabId = clickedButton.dataset.tab;
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === targetTabId) {
                    content.classList.add('active');
                }
            });
        }

        sidebarLinks.forEach(link => { link.addEventListener('click', function() { activateModule(this.dataset.module); }); });
        mainSearchInput.addEventListener('keypress', function(e) { /* ... */ });
        
        // Simplified auth logic for this step - actual logic is in the previous subtask
        logoutButton.addEventListener('click', function() {
            console.log('Logout action triggered'); // Placeholder
            alert('您已成功退出系统！'); // Placeholder
            // Actual logout logic (API call, redirect) should be confirmed by subtask 2.3
        });

         function checkLoginStatusAndSetup() {
            // This is a simplified version for Part 1 of this subtask.
            // The full auth check from subtask 2.3 will handle actual API calls.
            const storedUser = sessionStorage.getItem('username'); // Example, actual check is more robust
            if (storedUser) {
                if(usernameDisplay) usernameDisplay.textContent = storedUser;
                initializePage();
            } else {
                // If no user, actual app would redirect to login.html
                // For this subtask, we just initialize the page if index.html is loaded directly.
                initializePage(); 
            }
        }


        function loadDashboardStats() { /* ... same as provided ... */ 
            const homeModuleContent = contentArea.querySelector('#homeModuleContent');
            if (!homeModuleContent) return; 
            const counts = { fiberDataCount: Math.floor(Math.random()*1800+700), compositeDataCount: Math.floor(Math.random()*800+300), ballisticDataCount: Math.floor(Math.random()*150+50), literatureDataCount: Math.floor(Math.random()*400+100) };
            for (const id in counts) { const element = homeModuleContent.querySelector(`#${id}`); if (element) element.textContent = counts[id] + ' 条'; }
        }
        function addQuickNavListeners() { /* ... same as provided ... */ 
            const homeModuleContent = contentArea.querySelector('#homeModuleContent');
            if (!homeModuleContent) return;
            const quickNavLinks = homeModuleContent.querySelectorAll('.quick-nav-link');
            quickNavLinks.forEach(link => { link.removeEventListener('click', handleQuickNavLink); link.addEventListener('click', handleQuickNavLink); });
        }
        function handleQuickNavLink(e) { e.preventDefault(); activateModule(this.dataset.targetModule); }
        function addLearnMoreListeners() { /* ... same as provided ... */ 
            const homeModuleContent = contentArea.querySelector('#homeModuleContent');
            if (!homeModuleContent) return;
            const learnMoreBtn = homeModuleContent.querySelector('.learn-more-btn');
            if (learnMoreBtn) { learnMoreBtn.removeEventListener('click', handleLearnMore); learnMoreBtn.addEventListener('click', handleLearnMore); }
            const quickStartBtn = homeModuleContent.querySelector('.quick-start-btn');
            if(quickStartBtn) { quickStartBtn.removeEventListener('click', handleQuickStart); quickStartBtn.addEventListener('click', handleQuickStart); }
        }
        function handleLearnMore() { activateModule('system_guide'); }
        function handleQuickStart() { mainSearchInput.focus(); }
        function initializePage() { activateModule('home'); }
        
        // Initial call to setup based on auth status
        checkLoginStatusAndSetup(); // Or simply initializePage() if auth check is fully in 2.3
    </script>
    <script src="js/resin_spinning_module.js" defer></script> <!-- Link the new module script -->
</body>
</html>
